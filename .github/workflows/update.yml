name: ðŸ”ƒ Update article lists

on:
  schedule:
    - cron:  '* * * * *'
  push:
    branches:
      - master
    paths:
      - 'scripts/update_list/**'
      - '.github/workflows/update.yml'

jobs:
  update-list:
      runs-on: ubuntu-latest
      steps:
        - name: set up
          uses: actions/setup-go@v2

        - name: checkout
          uses: actions/checkout@v2

        - name: run script
          env:
            HATENA_ID: ${{ secrets.HATENA_ID }}
            HATENA_BLOG_ID: ${{ secrets.HATENA_BLOG_ID }}
            HATENA_USER_NAME: ${{ secrets.HATENA_USER_NAME }}
            HATENA_PASSWORD: ${{ secrets.HATENA_PASSSWORD }}
          run: |
            go mod download
            go run main.go
          working-directory: ./scripts/update_list

        - name: commit and push src
          run: |
            git config --local user.email "auto-deploy"
            git config --local user.name "auto-deploy"
            git add --all
            git commit -m "update JSON"
            git push origin master